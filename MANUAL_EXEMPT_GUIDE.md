# 手动用户豁免系统使用指南

## 🎯 功能说明

Discord机器人默认限制每个用户每天只能使用3次股票查询功能。管理员可以通过Discord命令手动添加豁免用户，让特定用户无限制使用所有功能。

## 🔧 管理员豁免命令

### 添加豁免用户
```
!exempt_add <用户ID> [豁免原因]
```

**示例**：
```
!exempt_add 123456789012345678 VIP用户
!exempt_add 987654321098765432 内测用户
!exempt_add 111222333444555666
```

### 移除豁免用户
```
!exempt_remove <用户ID>
```

**示例**：
```
!exempt_remove 123456789012345678
```

### 查看豁免用户列表
```
!exempt_list
```

显示所有当前豁免用户的信息，包括用户名、ID、豁免原因和添加时间。

## 👤 用户查询命令

### 查看个人配额
```
!quota
```

普通用户显示：今日已用次数/3，剩余次数
豁免用户显示：无请求限制，豁免用户状态

## 📋 获取用户ID方法

### 方法1：开发者模式（推荐）
1. Discord设置 → 高级 → 开发者模式（开启）
2. 右键点击用户头像 → 复制用户ID

### 方法2：通过@提及
```
!exempt_add @用户名 豁免原因
```

### 方法3：查看消息记录
当用户发送消息时，机器人日志会显示用户ID

## 🔍 权限要求

- **管理员命令**：`!exempt_add`, `!exempt_remove`, `!exempt_list` 需要Discord管理员权限
- **用户命令**：`!quota` 所有用户都可以使用

## 📊 豁免状态验证

### 用户侧验证
豁免用户使用 `!quota` 命令会看到：
```
🌟 豁免用户状态
用户：用户名
权限：无请求限制
状态：豁免用户
```

### 管理员侧验证
1. 使用 `!exempt_list` 查看是否在豁免列表中
2. 观察用户使用超过3次功能是否仍然正常工作
3. 查看日志中的 "用户 XXX 在豁免列表中，无限制" 消息

## 💡 使用场景示例

### 场景1：VIP用户
```
!exempt_add 123456789012345678 VIP用户无限制
```

### 场景2：测试用户
```
!exempt_add 987654321098765432 内测功能测试
```

### 场景3：工作需要
```
!exempt_add 111222333444555666 工作需要频繁查询
```

### 场景4：临时豁免
```
# 添加临时豁免
!exempt_add 555666777888999000 临时需要

# 使用完毕后移除
!exempt_remove 555666777888999000
```

## 📈 监控和管理

### 查看使用统计
```
!logs
```

显示今日所有用户的使用统计，包括豁免用户的使用情况

### 定期审查
建议管理员定期使用 `!exempt_list` 检查豁免列表，移除不再需要的豁免用户

## ⚠️ 注意事项

1. **用户ID准确性**：确保添加豁免时使用正确的用户ID，错误的ID会添加失败或添加错用户
2. **权限管理**：只有Discord服务器管理员才能执行豁免管理命令
3. **数据持久化**：豁免状态保存在数据库中，重启机器人后仍然有效
4. **使用记录**：即使是豁免用户，系统仍会记录其使用情况用于统计

## 🔧 故障排除

### 命令无响应
- 检查是否有Discord管理员权限
- 确认机器人在线且正常工作

### 用户ID无效
- 使用开发者模式重新获取用户ID
- 确认用户在同一Discord服务器中

### 豁免未生效
- 使用 `!exempt_list` 确认用户已在豁免列表中
- 检查用户ID是否正确
- 查看机器人日志确认豁免状态

## 📞 相关命令汇总

| 命令 | 权限 | 功能 |
|------|------|------|
| `!exempt_add <用户ID> [原因]` | 管理员 | 添加豁免用户 |
| `!exempt_remove <用户ID>` | 管理员 | 移除豁免用户 |
| `!exempt_list` | 管理员 | 查看豁免列表 |
| `!quota` | 所有用户 | 查看个人配额 |
| `!logs` | 所有用户 | 查看使用统计 |

---

**通过手动豁免系统，您可以精确控制哪些用户可以无限制使用机器人功能！**