# 📊 每日用户请求日志系统使用指南

## 概述
新的日志系统可以实时记录和跟踪所有用户的Discord机器人请求，包括图表获取、股票预测和图片分析功能。

## 核心功能

### 1. 自动日志记录
- **实时记录**：所有用户请求都会自动记录到日志中
- **详细信息**：记录用户ID、用户名、请求类型、内容、成功状态、错误信息、频道和服务器信息
- **按日存储**：每天的日志存储在 `daily_logs/requests_YYYY-MM-DD.json` 文件中

### 2. 请求类型
- **📊 chart**: 股票图表请求 (如: AAPL 1h, TSLA 15m)
- **📈 prediction**: 股票预测分析请求 (如: 预测 AAPL 趋势)
- **🖼️ analysis**: 图表图片分析请求 (上传图片进行分析)

## 管理员工具

### Discord内置命令
使用 `!logs` 或 `!日志` 或 `!统计` 命令查看今日统计：
```
!logs
```
显示内容包括：
- 总请求数、成功率
- 请求类型分布
- 活跃用户列表 
- 最近请求记录

### 命令行工具

#### 查看今日详细统计
```bash
python log_viewer.py --today
```

#### 查看最近几天统计
```bash
python log_viewer.py --days 7  # 查看最近7天
```

#### 实时监控模式
```bash
python log_viewer.py --watch
```

## 日志数据结构

每条日志记录包含以下信息：
```json
{
  "timestamp": "2025-08-12T07:38:01.123456",
  "user_id": "1234567890",
  "username": "用户名", 
  "request_type": "chart",
  "content": "AAPL 1h",
  "success": true,
  "error": null,
  "channel": "频道名称",
  "guild": "服务器名称"
}
```

## 使用场景

### 1. 监控机器人使用情况
- 了解哪些用户最活跃
- 分析哪种功能最受欢迎
- 监控每日请求量趋势

### 2. 问题诊断
- 查看失败请求的错误信息
- 识别经常失败的请求类型
- 分析用户使用模式

### 3. 性能统计
- 计算成功率
- 分析用户分布
- 生成使用报告

## 日志文件位置
```
daily_logs/
├── requests_2025-08-12.json
├── requests_2025-08-11.json
└── ...
```

## 管理员权限
- Discord内的 `!logs` 命令需要管理员权限
- 命令行工具可以直接使用，无需特殊权限

## 注意事项
- 日志文件按天自动创建，无需手动管理
- 系统自动处理时区（使用系统本地时间）
- 豁免用户的请求同样会被记录到日志中
- 日志记录不影响机器人的正常功能